!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/forms"),require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("angular-cc-library",["exports","@angular/forms","@angular/core","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["angular-cc-library"]={},t.ng.forms,t.ng.core,t.rxjs)}(this,(function(t,e,r,n){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */Object.create;function a(t,e){var r="function"==typeof Symbol&&t[Symbol.iterator];if(!r)return t;var n,a,i=r.call(t),o=[];try{for(;(void 0===e||e-- >0)&&!(n=i.next()).done;)o.push(n.value)}catch(t){a={error:t}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return o}Object.create;var i=/(\d{1,4})/g,o=[{type:"maestro",patterns:[5018,502,503,506,56,58,639,6220,67],format:i,length:[12,13,14,15,16,17,18,19],cvvLength:[3],luhn:!0},{type:"forbrugsforeningen",patterns:[600],format:i,length:[16],cvvLength:[3],luhn:!0},{type:"dankort",patterns:[5019],format:i,length:[16],cvvLength:[3],luhn:!0},{type:"visa",patterns:[4],format:i,length:[13,16,19],cvvLength:[3],luhn:!0},{type:"mastercard",patterns:[51,52,53,54,55,22,23,24,25,26,27],format:i,length:[16],cvvLength:[3],luhn:!0},{type:"amex",patterns:[34,37],format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvvLength:[3,4],luhn:!0},{type:"dinersclub",patterns:[30,36,38,39],format:/(\d{1,4})(\d{1,6})?(\d{1,4})?/,length:[14],cvvLength:[3],luhn:!0},{type:"discover",patterns:[60,64,65,622],format:i,length:[16],cvvLength:[3],luhn:!0},{type:"unionpay",patterns:[62,88],format:i,length:[16,17,18,19],cvvLength:[3],luhn:!1},{type:"jcb",patterns:[35],format:i,length:[16,19],cvvLength:[3],luhn:!0}],s=function(){function t(){}return t.cards=function(){return o},t.cardFromNumber=function(t){t=(t+"").replace(/\D/g,"");for(var e=0,r=o.length;e<r;e++)for(var n=o[e],a=n.patterns,i=0,s=a.length;i<s;i++){var l=a[i]+"";if(t.substr(0,l.length)===l)return n}},t.restrictNumeric=function(t){if(t.metaKey||t.ctrlKey)return!0;if(32===t.which)return!1;if(0===t.which)return!0;if(t.which<33)return!0;var e=String.fromCharCode(t.which);return!!/[\d\s]/.test(e)},t.hasTextSelected=function(t){return null!==t.selectionStart&&t.selectionStart!==t.selectionEnd},t.cardType=function(t){if(!t)return t;var e=this.cardFromNumber(t);return null!=e?e.type:null},t.formatCardNumber=function(t){t=t.replace(/\D/g,"");var e=this.cardFromNumber(t);if(!e)return t;var r=e.length[e.length.length-1];if(t=t.slice(0,r),!e.format.global){var n=e.format.exec(t);if(null==n)return;return n.shift(),n.filter(Boolean).join(" ")}var a=t.match(e.format);return null!=a?a.join(" "):void 0},t.safeVal=function(t,e,r){var n=null,a=e.value,i=null;try{n=e.selectionStart}catch(t){}if(r(t),null!==n&&e===document.activeElement){if(n===a.length&&(n=t.length),a!==t){var o=a.slice(n-1,+n+1||9e9),s=t.slice(n-1,+n+1||9e9),l=t[n];/\d/.test(l)&&o===l+" "&&s===" "+l&&(n+=1)}i=n}return i},t.isCardNumber=function(e,r){var n=String.fromCharCode(e);if(!/^\d+$/.test(n))return!1;if(t.hasTextSelected(r))return!0;var a=(r.value+n).replace(/\D/g,""),i=t.cardFromNumber(a);return i?a.length<=i.length[i.length.length-1]:a.length<=16},t.restrictExpiry=function(t,e){var r=String.fromCharCode(t);return!(!/^\d+$/.test(r)||this.hasTextSelected(e))&&(""+e.value+r).replace(/\D/g,"").length>6},t.replaceFullWidthChars=function(t){null===t&&(t="");for(var e="",r=t.split(""),n=0;n<r.length;n++){var a=r[n],i="０１２３４５６７８９".indexOf(a);i>-1&&(a="0123456789"[i]),e+=a}return e},t.formatExpiry=function(t){var e=t.match(/^\D*(\d{1,2})(\D+)?(\d{1,4})?/);if(!e)return"";var r=e[1]||"",n=e[2]||"",a=e[3]||"";return a.length>0?n=" / ":" /"===n?(r=r.substring(0,1),n=""):2===r.length||n.length>0?n=" / ":1===r.length&&"0"!==r&&"1"!==r&&(r="0"+r,n=" / "),""+r+n+a},t.restrictCvc=function(t,e){var r=String.fromCharCode(t);return!(!/^\d+$/.test(r)||this.hasTextSelected(e))&&(""+e.value+r).length<=4},t.luhnCheck=function(t){for(var e=t.split("").reverse(),r=!0,n=0,a=0;a<e.length;a++){var i=parseInt(e[a],10);(r=!r)&&(i*=2),i>9&&(i-=9),n+=i}return n%10==0},t}(),l=function(){function t(){}return t.validateCCNumber=function(t){if(void 0!==e.Validators.required(t)&&null!==e.Validators.required(t))return{ccNumber:!0};var r=t.value.toString().replace(/\s+|-/g,"");if(!/^\d+$/.test(r))return{ccNumber:!0};var n=s.cardFromNumber(r);if(!n)return{ccNumber:!0};if(n.length.includes(r.length)&&(!1===n.luhn||s.luhnCheck(r)))return null;var a=n.length[n.length.length-1];if(r.length>a){var i=r.substring(0,a);if(s.luhnCheck(i))return null}return{ccNumber:!0}},t.validateExpDate=function(t){if(void 0!==e.Validators.required(t)&&null!==e.Validators.required(t))return{expDate:!0};if(void 0!==t.value&&t.value.length>=5){var r=a(t.value.split(/[\s\/]+/,2),2),n=r[0],i=r[1];if(2===(null!=i?i.length:void 0)&&/^\d+$/.test(i))i=(new Date).getFullYear().toString().slice(0,2)+i;if(n=parseInt(n,10).toString(),i=parseInt(i,10).toString(),/^\d+$/.test(n)&&/^\d+$/.test(i)&&n>=1&&n<=12){var o=new Date(i,n),s=new Date;if(o.setMonth(o.getMonth()-1),o.setMonth(o.getMonth()+1,1),o>s)return null}}return{expDate:!0}},t}(),u=function(){function t(t,e){this.el=t,this.control=e,this.cards=s.cards(),this.resolvedScheme$=new n.BehaviorSubject("unknown"),this.target=this.el.nativeElement}return t.prototype.updateValue=function(t){this.control?this.control.control.setValue(t):this.target.value=t},t.prototype.onKeypress=function(t){s.restrictNumeric(t)?s.isCardNumber(t.which,this.target)&&this.formatCardNumber(t):t.preventDefault()},t.prototype.onKeydown=function(t){this.formatBackCardNumber(t),this.reFormatCardNumber()},t.prototype.onKeyup=function(){this.setCardType()},t.prototype.onPaste=function(){this.reFormatCardNumber()},t.prototype.onChange=function(){this.reFormatCardNumber()},t.prototype.onInput=function(){this.reFormatCardNumber(),this.setCardType()},t.prototype.formatCardNumber=function(t){var e=String.fromCharCode(t.which);if(/^\d+$/.test(e)){var r=this.target.value,n=s.cardFromNumber(r+e);r.replace(/\D/g,""),n&&n.length[n.length.length-1]}},t.prototype.formatBackCardNumber=function(t){var e=this.target.value,r=this.target.selectionStart;8===t.which&&null!=r&&r===this.target.selectionEnd&&r>0&&r!==e.length&&" "===e[r-1]&&(t.preventDefault(),r<=2?(this.updateValue(e.slice(r)),this.target.selectionStart=0,this.target.selectionEnd=0):(this.updateValue(e.slice(0,r-2)+e.slice(r)),this.target.selectionStart=r-2,this.target.selectionEnd=r-2))},t.prototype.setCardType=function(){var t=this,e=s.cardType(this.target.value)||"unknown";this.resolvedScheme$.next(e),this.target.classList.contains(e)||(this.cards.forEach((function(e){t.target.classList.remove(e.type)})),this.target.classList.remove("unknown"),this.target.classList.add(e),this.target.classList.toggle("identified","unknown"!==e))},t.prototype.reFormatCardNumber=function(){var t=this,e=s.formatCardNumber(s.replaceFullWidthChars(this.target.value));e!==this.target.value&&(this.target.selectionStart=this.target.selectionEnd=s.safeVal(e,this.target,(function(e){t.updateValue(e)})))},t}();u.decorators=[{type:r.Directive,args:[{selector:"[ccNumber]",exportAs:"ccNumber"}]}],u.ctorParameters=function(){return[{type:r.ElementRef},{type:e.NgControl,decorators:[{type:r.Self},{type:r.Optional}]}]},u.propDecorators={onKeypress:[{type:r.HostListener,args:["keypress",["$event"]]}],onKeydown:[{type:r.HostListener,args:["keydown",["$event"]]}],onKeyup:[{type:r.HostListener,args:["keyup"]}],onPaste:[{type:r.HostListener,args:["paste"]}],onChange:[{type:r.HostListener,args:["change"]}],onInput:[{type:r.HostListener,args:["input"]}]};var c=function(){function t(t,e){this.el=t,this.control=e,this.target=this.el.nativeElement}return t.prototype.updateValue=function(t){this.control?this.control.control.setValue(t):this.target.value=t},t.prototype.onKeypress=function(t){s.restrictNumeric(t)||s.restrictCvc(t.which,this.target)||t.preventDefault()},t.prototype.reformatCvc=function(){var t=this,e=s.replaceFullWidthChars(this.target.value).replace(/\D/g,"").slice(0,4);e!==this.target.value&&(this.target.selectionStart=this.target.selectionEnd=s.safeVal(e,this.target,(function(e){t.updateValue(e)})))},t}();c.decorators=[{type:r.Directive,args:[{selector:"[ccCVC]"}]}],c.ctorParameters=function(){return[{type:r.ElementRef},{type:e.NgControl,decorators:[{type:r.Self},{type:r.Optional}]}]},c.propDecorators={onKeypress:[{type:r.HostListener,args:["keypress",["$event"]]}],reformatCvc:[{type:r.HostListener,args:["paste"]},{type:r.HostListener,args:["change"]},{type:r.HostListener,args:["input"]}]};var h=function(){function t(t,e){this.el=t,this.control=e,this.target=this.el.nativeElement}return t.prototype.updateValue=function(t){this.control?this.control.control.setValue(t):this.target.value=t},t.prototype.onKeypress=function(t){if(!s.restrictNumeric(t))return t.preventDefault(),!1;s.restrictExpiry(t.which,this.target)&&(this.formatExpiry(t),this.formatForwardSlashAndSpace(t),this.formatForwardExpiry(t))},t.prototype.onKeydown=function(t){s.restrictNumeric(t)&&s.restrictExpiry(t.which,this.target)&&this.formatBackExpiry(t)},t.prototype.onChange=function(){this.reformatExpiry()},t.prototype.onInput=function(){this.reformatExpiry()},t.prototype.formatExpiry=function(t){var e=String.fromCharCode(t.which),r=""+this.target.value+e;if(/^\d+$/.test(e))if(/^\d$/.test(r)&&"0"!==r&&"1"!==r)t.preventDefault(),this.updateValue("0"+r+" / ");else if(/^\d\d$/.test(r)){t.preventDefault();var n=parseInt(r[0],10),a=parseInt(r[1],10);a>2&&0!==n?this.updateValue("0"+n+" / "+a):this.updateValue(r+" / ")}},t.prototype.formatForwardSlashAndSpace=function(t){var e=String.fromCharCode(t.which),r=this.target.value;if("/"!==e&&" "!==e)return!1;/^\d$/.test(r)&&"0"!==r&&this.updateValue("0"+r+" / ")},t.prototype.formatForwardExpiry=function(t){var e=String.fromCharCode(t.which),r=this.target.value;!/^\d+$/.test(e)&&/^\d\d$/.test(r)&&this.updateValue(this.target.value=r+" / ")},t.prototype.formatBackExpiry=function(t){var e=this.target.valueOf;8===t.which&&(null!=this.target.selectionStart&&this.target.selectionStart!==e.length||/\d\s\/\s$/.test(e)&&(t.preventDefault(),this.updateValue(e.replace(/\d\s\/\s$/,""))))},t.prototype.reformatExpiry=function(){var t=this,e=s.formatExpiry(s.replaceFullWidthChars(this.target.value));e!==this.target.value&&(this.target.selectionStart=this.target.selectionEnd=s.safeVal(e,this.target,(function(e){t.updateValue(e)})))},t}();h.decorators=[{type:r.Directive,args:[{selector:"[ccExp]"}]}],h.ctorParameters=function(){return[{type:r.ElementRef},{type:e.NgControl,decorators:[{type:r.Self},{type:r.Optional}]}]},h.propDecorators={onKeypress:[{type:r.HostListener,args:["keypress",["$event"]]}],onKeydown:[{type:r.HostListener,args:["keydown",["$event"]]}],onChange:[{type:r.HostListener,args:["change"]}],onInput:[{type:r.HostListener,args:["input"]}]};var p=[u,h,c],f=function(){};f.decorators=[{type:r.NgModule,args:[{declarations:[p],exports:[p]}]}],t.CreditCard=s,t.CreditCardDirectivesModule=f,t.CreditCardFormatDirective=u,t.CreditCardValidators=l,t.CvcFormatDirective=c,t.ExpiryFormatDirective=h,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=angular-cc-library.umd.min.js.map